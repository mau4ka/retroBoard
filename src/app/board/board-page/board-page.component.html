<app-board-header
  [userName]="userName"
  [loadingEnd]="loadingEnd"
  (getB)="onNewCol($event)"
></app-board-header>

<app-alert></app-alert>

<div class="alert alert-danger" *ngIf="tasksService.error$ | async as error">
  {{ error }}
</div>

<ng-template #load>
  <app-preloader></app-preloader>
</ng-template>

<div class="none">
  <table id="excel-table">
    <tbody>
      <tr>
        <th>Block #</th>
        <th>Block name</th>
        <th>Tasks...</th>
      </tr>
      <tr *ngFor="let task of tasks; let i = index">
        <th>{{ i + 1 }}</th>
        <td>{{ task.name }}</td>
        <td *ngFor="let item of task.tasks">{{ item.text }}</td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="loadingEnd; else load" class="board-container">
  <button (click)="scrollRigth()" class="scrollButtonR">&#62;</button>
  <button (click)="scrollLeft()" class="scrollButtonL">&#60;</button>
  <div
    class="board"
    id="board"
    cdkDropList
    (cdkDropListDropped)="dropColumn($event)"
    [cdkDropListData]="tasks"
    cdkDropListOrientation="horizontal"
    cdkDropListGroup
    #widgetsContent
  >
    <div class="column-container" *ngFor="let task of tasks" cdkDrag>
      <div class="column-name-del">
        <button (click)="deleteColumn(task._id || '')">&#10006;</button>
        <h2 class="center">{{ task.name | uppercase }}</h2>
        <div class="column-handle" cdkDragHandle>
          <svg width="24px" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
            ></path>
            <path d="M0 0h24v24H0z" fill="none"></path>
          </svg>
        </div>
      </div>
      <form
        class="form-addTask"
        (submit)="newTask(addTask.value, task._id || '')"
      >
        <input class="input-addTask" type="text" id="addTask" #addTask />
        <button class="pointer" type="submit">&#10010;</button>
      </form>

      <div
        cdkDropList
        [cdkDropListData]="task.tasks"
        class="colimn-list"
        (cdkDropListDropped)="drop($event, task.name)"
        id="{{ task._id }}"
      >
        <div class="task-box" *ngFor="let item of task.tasks" cdkDrag>
          <div class="task-name-del">
            <p>{{ item.text }}</p>
            <button (click)="deleteTask(task._id || '', item._id || '')">
              &#10006;
            </button>
          </div>

          <p>Author: {{ item.author }}</p>

          <div>
            <p>
              {{ item.likes?.length }}
              <span
                (click)="addLike(task._id || '', item._id || '')"
                class="heart"
                [ngClass]="heartType(item)"
                >&#10084;</span
              >
              <span (click)="showComm(item._id || '')" class="pointer">
                {{ item.comments?.length }}

                <app-svg-heart></app-svg-heart>
              </span>
            </p>
          </div>
          <div
            [ngClass]="
              selectedStyles.includes(item._id || ' ') ? 'block' : 'none'
            "
          >
            <div class="comment" *ngFor="let com of item.comments">
              <b>{{ com.author }}</b>
              <p>{{ com.text }}</p>
            </div>
            <form
              (submit)="addComm(task._id || '', item._id || '', comment.value)"
              class="form-comm"
            >
              <input
                class="input-comm"
                type="text"
                id="comment"
                #comment
              /><button class="pointer" type="submit">&#10010;</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
